<!DOCTYPE html>
<html>
<head>
  <title>AHS Grade Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Harys Dalvi">
  <meta name="description" content="Free Grade Calculator">
  <meta charset="utf-8">
  <link rel="icon" href="favicon.ico">
<style>
  body {
    background-color: #DDF0FF;
    font-family: "Baskerville", "Times New Roman";
    padding-left: 10%;
    padding-right: 10%;
    padding-top: 30px;
    padding-bottom: 70px;
  }
  h1,h2,h3 {
    margin-left: 30%;
  }
  p#javascript {
    margin-left: 40px;
    font-weight: bold;
    color: #0088AA;
  }
  div.button {
    color: #FFFFFF;
    background-color: #0088AA;
    border: 1px solid #99AAFF;
    min-width: 70px;
    max-width: 200px;
    padding-left: 20px;
    padding-right: 20px;
    padding-top: 10px;
    padding-bottom: 10px;
    text-align: center;
    cursor: pointer;
  }
  div.button:hover {
    background-color: #0099CC;
  }
  div.button.selected {
    background-color: #00AADD;
  }
  div.button.selected:hover {
    background-color: #00BBEE;
  }
  div.centerButtons {
    display: flex;
    margin-left: 20%;
    margin-right: 20%;
    justify-content: center;
  }
  textarea {
    width: 80%;
    background-color: #DDDEDF;
    padding: 5px;
    min-height: 500px;
    font-family: "Courier New", "Courier", monospace;
    resize: none;
  }
  img {
    width: 100%;
  }
  div#ahsDiv {
    text-align: center;
  }
  img#ahs {
    max-width: 200px;
  }
  ul.faq li {
    font-weight: bold;
  }
</style>
</head>
<body>

<h3>Harys Dalvi's Aesthetically Pleasing</h3>
<h1>AHS* Grade Calculator</h1>
<p style="font-size: 8px;">
  *Harys Dalvi's Aesthetically Pleasing AHS Grade Calculator is not endorsed by, directly
  affiliated with, maintained, authorized, or sponsored by American Learning Systems, Inc.
  or any of its subsidiaries or its affiliates. The names American Heritage School and AHS
  as well as related names, marks, emblems, and images are registered trademarks of their
  respective owners. This website should not be misconstrued as an attempt to steal rights
  to usurp power and administer American Heritage School or any of its affiliates.
</p>
<div id="ahsDiv"><img id="ahs" src="https://www.ahschool.com/data/news/thumbs/1579.full.jpg"></div>

<hr>
<div class="main" id="start">
  <p>Welcome to the grade calculator. First, you need to make sure you have
  JavaScript. If you don't know what that is, don't worry. I'll do it for you:</p>
  <p id="javascript">If you're reading this message, you do not have JavaScript.
    Unfortunately, you cannot use this page. If you're on a mobile device,
    try opening this with a computer. Check your browser settings to make sure
    JavaScript is on.</p><br><br>
  <script>
  document.getElementById("javascript").innerHTML = "If you're reading this message, you have JavaScript and can use this page.";
  </script>
  <div class="button" onclick="changeMode('FAQs')">FAQs</div>
  Begin by selecting how you will input your grades:<br><br>
  <div class="centerButtons">
    <div class="button" onclick="changeMode('manual');" id="manualInput">Manual input</div>
    <div class="button" onclick="changeMode('auto');">Automatic calculation</div>
  </div>
  <div class="centerButtons">
    <div class="button" onclick="changeMode('semester')">Semester/Exam grades</div>
  </div>
  <p><strong>Automatic is recommended</strong> but manual may be more accurate in case I programmed this wrong. (I'm pretty sure I programmed
    it right. I have tested it extensively including point system, missing assignments, letter grades, pending, and excused.)</p>
  <p>I will <strong>never</strong> use the information you give here to make fun of you. In fact, I don't know how to. I have
    no way of knowing what you type here because I am not good at programming in PHP. JavaScript is considered a &ldquo;client side&rdquo;
    programming language, which means all the code runs on your computer without transferring data anywhere else.</p>
</div>
<div class="main" id="manual">
  <div class="button" onclick="changeMode('start')">Back</div><br>
  <p id="beginCategories">Begin by creating categories for grades. If the class is based on point system, make a category
    called something like "Total" and consider it 100% of your grade.</p>
  <p id="manualCategory"></p>
  <div id="manualCategories"></div><br>
  <div class="button" onclick="changeMode('category')">New Category</div>
</div>
<div class="main" id="category">
  <div class="button" onclick="changeMode('manual')">Back</div><br>
  <p>If the class is based on point system, make a category
    called something like "Total" and consider it 100% of your grade.
    Please don't make a category with an existing name, as I am too
    lazy to make sure you don't do so.</p>
  <form name="category" action = "javascript:void(0)">
    Name: <input name="name" type="text" size="15"></input><br>
    Percentage: <input name="percent" type="number" size="5"></input>%<br><br>
    <div class="button" onclick="createCategory();">Create category</div>
  </form>
</div>
<div class="main" id="editCategory">
  <div class="button" onclick="updateCategories(); changeMode('manual');">Done</div><br>
  <p>Enter Score/Possible. Examples: 5/6.0, 8.5/9, B+/50.0, NTI/10.00<br>To delete an assignment, enter its score <strong>in
    the same way</strong> and click "Delete Assignment".<br>
    To <strong>change the grade on an assignment</strong>, add or remove an assignment out of 0 points (ex: 5/0).</p>
  <form name="editCategory" action = "javascript:void(0)">
    <input name="score" type="text" size="5"></input>/<input name="possible" type="number" size="5"></input>
    <br><br><div class="button" onclick="addAssignment()">Add Assignment</div>
    <div class="button" onclick="deleteAssignment()">Delete Assignment</div><br>
    <input name="percent" type="number" size="5"></input>%<br>
    <div class="button" onclick="changePercent()">Change Percentage</div>
  </form>
</div>
<div class="main" id="auto">
  <div class="button" onclick="changeMode('start')">Back</div>
  <p>Congratulations on trying to be cool with automatic grade calculation. Simply copy your grades
  from MyBackpack as shown in the image below.</p>
  <p>(If you are on a <strong>mobile device</strong>, including iPads, you should select <i>Assignment</i>,
    then select all the grades, and finally deselect the row that says <i>Assignment</i>)</p>
  <img src="auto.png">
  <p>Now paste them into the box below and click <strong>Next</strong> under the box:</p>
  <textarea id="inputGrades"></textarea><br>
  <div class="button" onclick="autoGrade();">Next</div>
</div>
<div class="main" id="finalAuto">
  <p>My super cool algorithm simplified your grades to the following (Category, Score/Possible):</p>
  <p id="autoResult"></p>
  <p><strong>If no grades have been entered yet</strong> for a category, that category may be missing from the above list.
    Don't worry, you can manually add that category after the calculation. Also don't worry if this class
    is based on <strong>point system</strong> rather than categories.</p><br>
  <p>Should I continue?</p>
  <div class="centerButtons">
    <div class="button" onclick="changeMode('manual')">No, let me manually enter grades.</div>
    <div class="button" onclick="autoCats(); changeMode('autoCategories');">Yes, continue.</div>
  </div>
</div>
<div class="main" id="autoCategories">
  <p><strong>Select a class</strong> to automatically fill in percentages/weighting. (Credit to Adin Groper for this idea)</p>
  <form name="classes" action="javascript:void(0)"><select name="class" onchange="setclass();">
    <option value="">-- Select a class -- </option>
    <optgroup label="Core Classes">
      <option value="apush">American History (AP)</option>
      <option value="ap bio">Biology (AP)</option>
      <option value="ap chem">Chemistry (AP)</option>
      <option value="ap lang">English Language & Composition (AP, Brown)</option>
      <option value="ap enviro">Environmental Science (AP)</option>
      <option value="ap physics 1">Physics 1 (AP)</option>
      <option value="precalc">Pre-Calculus (H)</option>
      <option value="stats">Statistics (AP)</option>
      <option value="mandarin 3">中文三</option>
    </optgroup>
    <optgroup label="Electives">
      <option value="research">Scientific/Summer Research</option>
    </optgroup>
  </select></form>
  <p>Please enter a percentage for each category <strong><i>or</i></strong> check that this class is point system:</p>
  <form name="autoCategories" action="javascript:void(0)"></form>
</div>
<div class="main" id="FAQs">
  <div class="button" onclick="changeMode('start')">Back</div>
  <h3>Frequently Asked Questions</h3>
  <ul class="faq">
    <li>Q: Why doesn't it work?</li>
    <b>A:</b> Because you are a monkey. This algorithm is definitely foolproof and if it doesn't work you did something wrong.
    Make sure to <strong>read all instructions</strong> carefully.
    The exception is my boy <strong>Mr. Rampal</strong> (AP Calculus), who should be Dr. Rampal and whose grading system breaks this website.
    For his class, one option is to <strong>manually add assignments multiple times</strong> as appropriate. To figure out how many times to include
    an assignment, click on it in MyBackpack and see "<strong>Count As</strong>". Automatic grading will include it once, but you may
    have to add it more times.
    <li>Q: What if a category is missing?</li>
    <b>A:</b> If a category is missing, <strong>enter its normal percentage</strong> and everything will be ok. For example, if there is no test grade in for AP Lang,
    enter 5% for MC Quizzes, 25% for Quizzes, and 20% for Homework. Note that selecting a class from the menu may not work if a
    category is missing.
    <li>Q: Can you add my class?</li>
    <b>A:</b> Yes. Contact me somehow and give me the grading scale for the class, the name of the class, and the exact names of the categories in MyBackpack.
    <li>Q: Why did you make this?</li>
    <b>A:</b> I noticed people taking too long to calculate their grades and decided to ease their pain using my mad skilz.
    <li>Q: How did you make this?</li>
    <b>A:</b> I used a combination of HTML (to make it exist), CSS (to make it aesthetically pleasing), and JavaScript (to make it work).
    JavaScript is a superior language to Java, from which it is entirely separate. Anyone who says Java is better than JavaScript
    without referencing Minecraft is wrong.
    <li>Q: How are you so cool?</li>
    <b>A:</b> I don't try to be cool, it's all natural. I would like to thank Fritz for being cool.
  </ul>
</div>
<div class="main" id="semester">
  <br><div class="button" onclick="changeMode('start')">Back</div><br>
  <form name="semester" action="javascript:void(0)">
    Quarter 1/3 grade: <select name="q1">
      <option value="98.5">A+</option>
      <option value="95">A</option>
      <option value="91.5">A-</option>
      <option value="88.5">B+</option>
      <option value="85">B</option>
      <option value="81.5">B-</option>
      <option value="78.5">C+</option>
      <option value="75">C</option>
      <option value="71.5">C-</option>
      <option value="68.5">D+</option>
      <option value="65">D</option>
      <option value="61.5">D-</option>
    </select><br>
    Quarter 2/4 grade: <select name="q2">
      <option value="98.5">A+</option>
      <option value="95">A</option>
      <option value="91.5">A-</option>
      <option value="88.5">B+</option>
      <option value="85">B</option>
      <option value="81.5">B-</option>
      <option value="78.5">C+</option>
      <option value="75">C</option>
      <option value="71.5">C-</option>
      <option value="68.5">D+</option>
      <option value="65">D</option>
      <option value="61.5">D-</option>
    </select><br>
    I want at least: <select name="target">
      <option value="96.5">A+</option>
      <option value="92.5">A</option>
      <option value="89.5">A-</option>
      <option value="86.5">B+</option>
      <option value="82.5">B</option>
      <option value="79.5">B-</option>
      <option value="76.5">C+</option>
      <option value="72.5">C</option>
      <option value="69.5">C-</option>
      <option value="66.5">D+</option>
      <option value="62.5">D</option>
      <option value="59.5">D-</option>
    </select><br>
    <div class="button" onclick="calculateSemester();">Calculate</div>
  </form>
  <b><span id="semesterGrade"></span></b>
</div>

<script>
var mode = "start";
var categories = [];
var currentCategory = null;
var divs = document.getElementsByClassName("main");
var autoCalc = [];
function changeMode(mode) {
  for (var i = 0; i < divs.length; i++) {
    if (divs[i].id != mode)
      divs[i].style.display = "none";
    else
      divs[i].style.display = "block";
  }
}
changeMode("start");
function makeNumber(grade, possible=100.0) {
  switch(grade) {
    case "A+": grade=98.5; break;
    case "A": grade=95; break;
    case "A-": grade=91.5; break;
    case "B+": grade=88.5; break;
    case "B": grade=85; break;
    case "B-": grade=81.5; break;
    case "C+": grade=78.5; break;
    case "C": grade=75; break;
    case "C-": grade=71.5; break;
    case "D+": grade=68.5; break;
    case "D": grade=65; break;
    case "D-": grade=61.5; break;
    case "F+": grade=58.5; break;
    case "F": grade=30; break;
    case "F-": grade=0; break;
    case "NTI": grade = 0; break;
    default: return new Number(grade);
  }
  return new Number(grade*possible/100.0);
}
class Category {
  constructor(name, percentage) {
    this.name = name;
    this.percentage = percentage;
    this.total = 0.0;
    this.possible = 0.0;
    categories.push(this);
  }
  add(total, possible) {
    this.total += makeNumber(total, possible);
    this.possible += makeNumber(possible);
  }
  remove (total, possible) {
    this.total -= makeNumber(total, possible);
    this.possible -= makeNumber(possible);
  }
  score() {
    return (this.total/this.possible)*100.0;
  }
}
function roundDecimal(num, places) {
  if (isNaN(num)) return "ERROR";
  var n = Math.round(num*Math.pow(10.0, places))/Math.pow(10.0, places);
  n = n.toString();
  var decimals = n.slice(n.indexOf(".") + 1).length;
  if (n.indexOf(".") == -1) {
    decimals = 0;
    n += ".";
  }
  for (var i = 0; i < places-decimals; i++) n += "0";
  return n;
}
function updateCategories() {
  var categoryP = document.getElementById("manualCategory");
  var categoryList = document.getElementById("manualCategories");
  document.getElementById("beginCategories").innerHTML = categories.length > 0 ? "" :
    "Begin by creating categories for grades. If the class is based on point system, make a category called something like \"Total\" and consider it 100% of your grade.";
  categoryList.innerHTML = "Please <strong>click a category</strong> to add or remove assignments and to see that category's score.<br><br>Categories:<br>";
  var totalPercent = 0;
  var categoryScore = 0;
  var totalScore = 0;
  for (var i = 0; i < categories.length; i++) {
    let newCategory = document.createElement("div");
    categoryList.appendChild(newCategory);
    newCategory.innerHTML = categories[i].name + " (" + categories[i].percentage + "%)";
    newCategory.className = "button";
    newCategory.onclick = function(cat) { return function() {
      currentCategory = cat;
      document.editCategory.percent.value = currentCategory.percentage;
      changeMode("editCategory");
    }}(categories[i]);
    if (currentCategory != null && categories[i].name == currentCategory.name) {
      newCategory.className = "button selected";
      categoryScore = categories[i].score();
    }
    totalPercent += categories[i].percentage;
    totalScore += categories[i].score()*categories[i].percentage/100.0;
  }
  totalScore /= (totalPercent/100.0);
  categoryP.innerHTML = "Score so far in this class: " + roundDecimal(totalScore, 2) +
    "% (Unweighted GPA: " + roundDecimal(totalScore/20.0 - 1, 2) + ")" +
    "<br>Sum of all categories: " + Math.round(totalPercent) + "% (Should be 100%)<br>";
  if (currentCategory == null)
    categoryP.innerHTML += "No category is currently selected";
  else
    categoryP.innerHTML += "Score so far in " + currentCategory.name + ": " + roundDecimal(categoryScore, 2) + "%";
  if (isNaN(totalScore))
    categoryP.innerHTML += "<br><b>You have a denominator of zero or another error in at least one category." +
      " Try adding some assignments.</b>";
}
function createCategory() {
  currentCategory = new Category(document.category.name.value, new Number(document.category.percent.value));
  document.category.name.value = "";
  document.category.percent.value = "";
  updateCategories();
  changeMode("manual");
}
function addAssignment() {
  currentCategory.add(document.editCategory.score.value, document.editCategory.possible.value);
  document.editCategory.score.value = "";
  document.editCategory.possible.value = "";
}
function deleteAssignment() {
  currentCategory.remove(document.editCategory.score.value, document.editCategory.possible.value);
  document.editCategory.score.value = "";
  document.editCategory.possible.value = "";
}
function changePercent() {
  currentCategory.percentage = new Number(document.editCategory.percent.value);
}
function findCategories(autoResult) {
  var cats = [];
  for (var i = 0; i < autoResult.length; i++) {
    if (cats.indexOf(autoResult[i][0]) == -1)
      cats.push(autoResult[i][0]);
  }
  cats.sort();
  return cats;
}
if(typeof(String.prototype.trim) === "undefined")
{
    String.prototype.trim = function()
    {
        return String(this).replace(/^\s+|\s+$/g, '');
    };
}
function autoGrade() {
  var temp = [];
  var temp2 = [];
  autoCalc = document.getElementById("inputGrades").value.split("\n");
  document.getElementById("inputGrades").value = "";
  while (autoCalc.indexOf("Comment") != -1 || autoCalc.indexOf("Missing Assignment") != -1)
    autoCalc.shift();
  for (var i = 1; i < autoCalc.length; i += 2) {
    autoCalc[i] = autoCalc[i].trim();
    let splitArray = autoCalc[i].split("\t");
    temp = [];
    temp.push(splitArray[0]);
    temp.push(splitArray[1]);
    temp.push(splitArray[2]);
    if (["", " ", "P", "EXC", "EX"].indexOf(splitArray[1]) == -1)
      temp2.push(temp);
  }
  autoCalc = temp2;
  document.getElementById("autoResult").innerHTML = "";
  for (var i = 0; i < temp2.length; i++) {
    document.getElementById("autoResult").innerHTML += temp2[i][0] + ", " +
      temp2[i][1] + "/" + temp2[i][2] + "<br>";
  }
  document.getElementById("autoResult").innerHTML += "<br>" + findCategories(autoCalc).length +
    " categories found: ";
  document.getElementById("autoResult").innerHTML += findCategories(autoCalc);
  changeMode("finalAuto");
}
function autoCats() {
  var form = document.autoCategories;
  var cats = findCategories(autoCalc);
  form.innerHTML = "";
  for (var i = 0; i < cats.length; i++) {
    form.innerHTML += cats[i] + ": <input name='" + i + "' type='number'></input>%<br>";
  }
  form.innerHTML += '<input type="checkbox" name="point"></input> This class is point system<br>'
  form.innerHTML += '<br><div class="button" onclick="autoCalc2();">Next</div>';
}
function categoryByName(name) {
  for (var i = 0; i < categories.length; i++) {
    if (categories[i].name == name) return categories[i];
  }
  return null;
}
function autoCalc2() {
  var cats = findCategories(autoCalc);
  categories = [];
  if (document.autoCategories.point.checked) {
    currentCategory = new Category("Total", 100);
    for (var i = 0; i < autoCalc.length; i++) {
      categories[0].add(autoCalc[i][1], autoCalc[i][2]);
    }
  } else {
    for (var i = 0; i < cats.length; i++) {
      new Category(cats[i], new Number(document.autoCategories[new Number(i).toString()].value));
    }
    for (var i = 0; i < autoCalc.length; i++) {
      categoryByName(autoCalc[i][0]).add(autoCalc[i][1], autoCalc[i][2]);
    }
    currentCategory = null;
  }
  updateCategories();
  changeMode("manual");
  document.getElementById("manualInput").innerHTML = "Edit grades";
}
var classes = {"ap lang": [false, 20, 5, 25, 50],
  "apush": [false, 20, 20, 20, 40],
  "ap chem": [false, 10, 25, 15, 50],
  "ap bio": [true],
  "ap enviro": [true],
  "ap physics 1": [false, 20, 20, 60],
  "spanish 4": [false, 10, 30, 25, 35],
  "apcsa": [false, 25, 75],
  "research": [true],
  "precalc": [true],
  "mandarin 3": [false, 10, 30, 25, 35],
  "stats": [false, 18, 20, 2, 60]};
function setclass() {
  var classData = classes[document.classes.class.value];
  document.autoCategories.point.checked = classData[0];
  for (var i = 0; i < findCategories(autoCalc).length; i++) {
    try { document.autoCategories[i].value = classData[i+1]; }
    catch (err) {}
  }
  document.classes.class.value = "";
}
function calculateSemester() {
  var target = new Number(document.semester.target.value);
  var q1 = new Number(document.semester.q1.value);
  var q2 = new Number(document.semester.q2.value);
  var grade = q1*0.4 + q2*0.4;
  var exam = 0;
  var required = -1;
  var grades = [61.5, 65, 68.5,
                71.5, 75, 78.5,
                81.5, 85, 88.5,
                91.5, 95, 98.5];
  var min = [59.5, 62.5, 66.5,
             69.5, 72.5, 76.5,
             79.5, 82.5, 86.5,
             89.5, 92.5, 96.5];
  for (var i = 0; i < 12; i++) {
    exam = grades[i];
    if (grade + exam*0.2 >= target) {
      required = i;
      break;
    }
  }
  var gradeDisplay = document.getElementById("semesterGrade");
  if (required == -1)
    gradeDisplay.innerHTML = "Unfortunately this grade is not possible for you this semester. Good luck for next semester!";
  else
    gradeDisplay.innerHTML = "Minimum grade required on semester exam: " + min[required] + "% (goes in as " + grades[required] + "%)";
  var fail = -1;
  for (var i = 59; i >= 0; i--) {
    if (grade + i*0.2 >= target)
      fail = i;
  }
  if (fail != -1)
    gradeDisplay.innerHTML = "Minimum grade required on semester exam: " + fail + "% (I hope you don't Fritz the exam that badly)";
}
</script>
<br><br><br><br><br><br><br><br><br><br>
</body>
</html>
